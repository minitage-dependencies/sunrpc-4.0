Only in sunrpc-4.0.3-1: CVS
Only in sunrpc-4.0.3-1: CYGWIN-PATCHES
Only in sunrpc-4.0.3-1: ChangeLog
diff -bBwur a/Makefile sunrpc-4.0.3-1/Makefile
--- a/Makefile	1989-07-11 21:49:38.000000000 +0200
+++ sunrpc-4.0.3-1/Makefile	2007-09-05 21:30:09.000000000 +0200
@@ -7,13 +7,19 @@
 #    /usr/lib /usr/bin /usr/include
 #
 DESTDIR=
-CFLAGS=-O
+CFLAGS='-g -O2 -I.. -L../rpc'
 MAKE=make
+EXT=.exe
 
-SUBDIR= rpcgen etc rpcsvc
+SUBDIR= rpcgen etc rpcsvc man
 
 all install:	rpclib ${SUBDIR}
 
+clean mostlyclean distclean: FRC
+	@for i in rpc $(SUBDIR); do		\
+		cd $$i; make clean; cd ..;	\
+	done
+
 rpclib:	FRC
 	@echo "Building and installing RPC library"
 	cd rpc; $(MAKE) ${MFLAGS} all DESTDIR=${DESTDIR}; \
Only in sunrpc-4.0.3-1: configure
Only in sunrpc-4.0.3-1/demo: CVS
Only in sunrpc-4.0.3-1/demo/dir: CVS
diff -bBwur a/demo/dir/Makefile sunrpc-4.0.3-1/demo/dir/Makefile
--- a/demo/dir/Makefile	1989-07-11 21:46:08.000000000 +0200
+++ sunrpc-4.0.3-1/demo/dir/Makefile	2007-09-05 21:30:08.000000000 +0200
@@ -1,7 +1,8 @@
 #
 # @(#)Makefile	2.1 88/08/02 4.0 RPCSRC
 #
-BIN = dir_svc rls
+EXT = .exe
+BIN = dir_svc$(EXT) rls$(EXT)
 GEN = dir_clnt.c dir_svc.c dir_xdr.c dir.h
 LIB = -lrpclib
 RPCCOM = rpcgen
@@ -11,10 +12,10 @@
 $(GEN): dir.x
 	$(RPCCOM) dir.x
 
-dir_svc: dir_proc.o dir_svc.o dir_xdr.o
+dir_svc$(EXT): dir_proc.o dir_svc.o dir_xdr.o
 	$(CC) -o $@ dir_proc.o dir_svc.o dir_xdr.o $(LIB)
 
-rls: rls.o dir_clnt.o dir_xdr.o
+rls$(EXT): rls.o dir_clnt.o dir_xdr.o
 	$(CC) -o $@ rls.o dir_clnt.o dir_xdr.o $(LIB)
 
 rls.o: rls.c dir.h
diff -bBwur a/demo/dir/dir_proc.c sunrpc-4.0.3-1/demo/dir/dir_proc.c
--- a/demo/dir/dir_proc.c	1989-07-11 21:46:10.000000000 +0200
+++ sunrpc-4.0.3-1/demo/dir/dir_proc.c	2007-09-05 21:30:08.000000000 +0200
@@ -3,10 +3,10 @@
  * dir_proc.c: remote readdir implementation
  */
 #include <rpc/rpc.h>
-#include <sys/dir.h>
+#include <sys/dirent.h>
 #include "dir.h"
+#include <errno.h>
 
-extern int errno;
 extern char *malloc();
 extern char *strcpy();
 
@@ -15,7 +15,7 @@
 	nametype *dirname;
 {
 	DIR *dirp;
-	struct direct *d;
+	struct dirent *d;
 	namelist nl;
 	namelist *nlp;
 	static readdir_res res; /* must be static! */
diff -bBwur a/demo/dir/rls.c sunrpc-4.0.3-1/demo/dir/rls.c
--- a/demo/dir/rls.c	1989-07-11 21:46:12.000000000 +0200
+++ sunrpc-4.0.3-1/demo/dir/rls.c	2007-09-05 21:30:08.000000000 +0200
@@ -5,8 +5,7 @@
 #include <stdio.h>
 #include <rpc/rpc.h>		/* always need this */
 #include "dir.h"		/* need this too: will be generated by rpcgen*/
-
-extern int errno;
+#include <errno.h>
 
 main(argc, argv)
 	int argc;
Only in sunrpc-4.0.3-1/demo/msg: CVS
diff -bBwur a/demo/msg/Makefile sunrpc-4.0.3-1/demo/msg/Makefile
--- a/demo/msg/Makefile	1989-07-11 21:45:57.000000000 +0200
+++ sunrpc-4.0.3-1/demo/msg/Makefile	2007-09-05 21:30:08.000000000 +0200
@@ -1,7 +1,8 @@
 #
 # @(#)Makefile	2.1 88/08/11 4.0 RPCSRC
 #
-BIN = printmsg msg_svc rprintmsg
+EXT = .exe
+BIN = printmsg$(EXT) msg_svc$(EXT) rprintmsg$(EXT)
 GEN = msg_clnt.c msg_svc.c msg.h
 LIB = -lrpclib
 RPCCOM = rpcgen
@@ -11,7 +12,7 @@
 #
 # This is the non-networked version of the program
 #
-printmsg: printmsg.o
+printmsg$(EXT): printmsg.o
 	$(CC) -o $@ printmsg.o
 
 #
@@ -21,10 +22,10 @@
 $(GEN): msg.x
 	$(RPCCOM) msg.x
 
-msg_svc: msg_proc.o msg_svc.o
+msg_svc$(EXT): msg_proc.o msg_svc.o
 	$(CC) -o $@ msg_proc.o msg_svc.o $(LIB)
 
-rprintmsg: rprintmsg.o msg_clnt.o
+rprintmsg$(EXT): rprintmsg.o msg_clnt.o
 	$(CC) -o $@ rprintmsg.o msg_clnt.o $(LIB)
 
 rprintmsg.o: rprintmsg.c msg.h
diff -bBwur a/demo/msg/msg_proc.c sunrpc-4.0.3-1/demo/msg/msg_proc.c
--- a/demo/msg/msg_proc.c	1989-07-11 21:45:59.000000000 +0200
+++ sunrpc-4.0.3-1/demo/msg/msg_proc.c	2007-09-05 21:30:08.000000000 +0200
@@ -14,6 +14,10 @@
 	char **msg;	
 {
 	static int result; /* must be static! */
+
+#ifdef __CYGWIN__
+	fprintf(stdout, "%s\n", *msg);
+#else
 	FILE *f;
 
 	f = fopen("/dev/console", "w");
@@ -23,6 +27,8 @@
 	}
 	fprintf(f, "%s\n", *msg);
 	fclose(f);
+#endif
+
 	result = 1;
 	return (&result);
 }
diff -bBwur a/demo/msg/printmsg.c sunrpc-4.0.3-1/demo/msg/printmsg.c
--- a/demo/msg/printmsg.c	1989-07-11 21:46:00.000000000 +0200
+++ sunrpc-4.0.3-1/demo/msg/printmsg.c	2007-09-05 21:30:08.000000000 +0200
@@ -31,6 +31,9 @@
 printmessage(msg)
 	char *msg;
 {
+#ifdef __CYGWIN__
+	fprintf(stdout, "%s\n", msg);
+#else
 	FILE *f;
 
 	f = fopen("/dev/console", "w");
@@ -39,5 +42,7 @@
 	}
 	fprintf(f, "%s\n", msg);
 	fclose(f);
+#endif
+
 	return(1);
 }
Only in sunrpc-4.0.3-1/demo/sort: CVS
diff -bBwur a/demo/sort/Makefile sunrpc-4.0.3-1/demo/sort/Makefile
--- a/demo/sort/Makefile	1989-07-11 21:45:46.000000000 +0200
+++ sunrpc-4.0.3-1/demo/sort/Makefile	2007-09-05 21:30:08.000000000 +0200
@@ -2,14 +2,15 @@
 # @(#)Makefile	2.1 88/08/11 4.0 RPCSRC
 #
 
-BIN =  rsort sort_svc
+EXT = .exe
+BIN =  rsort$(EXT) sort_svc$(EXT)
 GEN = sort_clnt.c sort_svc.c sort_xdr.c sort.h
 LIB = -lrpclib
 RPCCOM = rpcgen
 
 all: $(BIN)
 
-rsort: rsort.o sort_clnt.o sort_xdr.o
+rsort$(EXT): rsort.o sort_clnt.o sort_xdr.o
 	$(CC) $(LDFLAGS) -o $@ rsort.o sort_clnt.o sort_xdr.o $(LIB)
 
 rsort.o: rsort.c sort.h
@@ -17,7 +18,7 @@
 sort_clnt.c:
 	$(RPCCOM) -l sort.x >$@
 
-sort_svc: sort_proc.o sort_svc.o sort_xdr.o
+sort_svc$(EXT): sort_proc.o sort_svc.o sort_xdr.o
 	$(CC) $(LDFLAGS) -o $@ sort_proc.o sort_svc.o sort_xdr.o $(LIB)
 
 sort_proc.o: sort_proc.c sort.h
Only in sunrpc-4.0.3-1/doc: CVS
diff -bBwur a/doc/Makefile sunrpc-4.0.3-1/doc/Makefile
--- a/doc/Makefile	1989-07-11 21:49:18.000000000 +0200
+++ sunrpc-4.0.3-1/doc/Makefile	2007-09-05 21:30:09.000000000 +0200
@@ -6,7 +6,7 @@
 #   with nroff and troff, respectively.  The other *.nroff and *.troff
 #   targets will make individual documents
 #
-TROFF=	ditroff
+TROFF=	troff
 TOPTS=  -t
 NROFF=	nroff
 NOPTS=
@@ -22,7 +22,7 @@
 	@echo "Nothing installed."
 
 all.nroff:	${SRC}
-	${TBL} ${SRC} | ${EQN} | ${NROFF} ${NOPTS} -ms >all.nroff
+	${TBL} ${SRC} | ${PIC} | ${EQN} | ${NROFF} ${NOPTS} -ms >all.nroff
 
 all.troff:	${SRC}
 	${TBL} ${SRC} | ${PIC} | ${EQN} | ${TROFF} ${TOPTS} -ms >all.troff
Only in sunrpc-4.0.3-1/etc: CVS
diff -bBwur a/etc/Makefile sunrpc-4.0.3-1/etc/Makefile
--- a/etc/Makefile	1989-07-11 21:48:37.000000000 +0200
+++ sunrpc-4.0.3-1/etc/Makefile	2007-09-05 21:30:09.000000000 +0200
@@ -4,11 +4,11 @@
 #   Files and programs for /etc.  rpclib must have already been installed.
 #
 DESTDIR=
-CFLAGS=	-O
-LIB = -lrpclib
+CFLAGS= -g -O2
+LIB = -lrpclib -lnetapi32
 LDFLAGS= $(LIB)
-
 BIN = portmap rpcinfo
+EXT = .exe
 MISC= rpc
 
 all:	${BIN}
@@ -16,22 +16,23 @@
 portmap:
 	${CC} ${CFLAGS} -o $@ $@.c ${LDFLAGS}
 
-rpcinfo:	getopt.o
-	${CC} ${CFLAGS} -o $@ $@.c getopt.o ${LDFLAGS}
+rpcinfo:
+	${CC} ${CFLAGS} -o $@ $@.c ${LDFLAGS}
 
 install: ${BIN}
-	-mkdir ${DESTDIR}/etc && chown bin ${DESTDIR}/etc && \
-		chmod 755 ${DESTDIR}/etc
-	@echo "Installing RPC utility files in ${DESTDIR}/etc"
+	@echo "Installing RPC utility files in ${DESTDIR}/usr/sbin"
+	@mkdir -p ${DESTDIR}/usr/sbin
 	@set -x;for i in ${BIN}; do \
-		(install -s $$i ${DESTDIR}/etc/$$i); done
+		(install -s $$i ${DESTDIR}/usr/sbin/$$i); done
 	@echo "Installing ${DESTDIR}/etc/rpc"
+	@mkdir -p $(DESTDIR)/etc
 	@set -x;for i in ${MISC}; do \
 		(install -c -m 644 $$i ${DESTDIR}/etc/$$i); done
 
 clean:
 	rm -f core *.o
-	rm -f ${BIN}
+	for i in ${BIN}; do \
+		rm -f $$i$(EXT); done
 
 depend: ${BIN}
 	rm -f makedep
@@ -71,4 +72,6 @@
 
 # DO NOT DELETE THIS LINE -- make depend uses it
 
-
+# DEPENDENCIES MUST END AT END OF FILE
+# IF YOU PUT STUFF HERE IT WILL GO AWAY
+# see make depend above
diff -bBwur a/etc/portmap.c sunrpc-4.0.3-1/etc/portmap.c
--- a/etc/portmap.c	1989-07-11 21:48:40.000000000 +0200
+++ sunrpc-4.0.3-1/etc/portmap.c	2007-09-05 21:30:09.000000000 +0200
@@ -44,19 +44,74 @@
 #include <rpc/rpc.h>
 #include <rpc/pmap_prot.h>
 #include <stdio.h>
+#include <stdlib.h>
 #include <netdb.h>
 #include <sys/socket.h>
 #include <sys/ioctl.h>
 #include <sys/wait.h>
 #include <sys/signal.h>
 
-char *malloc();
+
+static callit();
+
 int reg_service();
 void reap();
 struct pmaplist *pmaplist;
 static int debugging = 0;
+static int do_fork = 1;
 
-main()
+int
+process_args(argc, argv)
+	int argc;
+	char** argv;
+{
+	int arg;
+	int arg_error = 0; /* no arg processing errors yet */
+	int show_use  = 0; /* no need to show usage message yet */
+	int i;
+
+	for (arg = 1; arg < argc; arg++) {
+		arg_error = 0;
+		if ('-' == argv[arg][0]) {
+			switch (argv[arg][1]) {
+				case 'F':
+					do_fork = 0;
+					break;
+				case 'd':
+					debugging = 1;
+					break;
+				case 'h':
+				case 'H':
+				case '?':
+					show_use = 1;
+					break;
+				default:
+					arg_error = 1;
+			}
+		} else {
+			arg_error = 1;
+		}
+
+		if (0 != arg_error) {
+			fprintf(stderr, "Invalid argument: %s\n", argv[arg]);
+			show_use = 1;
+		}
+	}
+
+	if (0 != show_use) {
+		fprintf(stdout, "Usage: %s [-D]\n", strrchr(argv[0], '/') + 1);
+		fprintf(stdout, "  -F : run server in foreground (do not fork on startup)\n");
+		fprintf(stdout, "  -d : verbose (debugging) output\n");
+		return 1;
+	}
+
+	return 0;
+}
+
+int
+main(argc, argv)
+	int argc;
+	char** argv;
 {
 	SVCXPRT *xprt;
 	int sock, pid, t;
@@ -64,7 +119,11 @@
 	int len = sizeof(struct sockaddr_in);
 	register struct pmaplist *pml;
 
-#ifndef DEBUG
+	if (0 != process_args(argc, argv)) {
+		exit(1);
+	}
+
+	if (0 != do_fork) {
 	pid = fork();
 	if (pid < 0) {
 		perror("portmap: fork");
@@ -77,12 +136,18 @@
  	open("/", 0);
  	dup2(0, 1);
  	dup2(0, 2);
+	#ifdef __CYGWIN__
+		setsid();
+	#else
  	t = open("/dev/tty", 2);
  	if (t >= 0) {
  		ioctl(t, TIOCNOTTY, (char *)0);
  		close(t);
  	}
 #endif
+
+	}
+
 	if ((sock = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP)) < 0) {
 		perror("portmap cannot create socket");
 		exit(1);
@@ -170,9 +235,10 @@
 	int ans, port;
 	caddr_t t;
 	
-#ifdef DEBUG
+	if (debugging) {
 	fprintf(stderr, "server: about do a switch\n");
-#endif
+	}
+
 	switch (rqstp->rq_proc) {
 
 	case PMAPPROC_NULL:
@@ -180,6 +246,7 @@
 		 * Null proc call
 		 */
 		if ((!svc_sendreply(xprt, xdr_void, NULL)) && debugging) {
+			fprintf(stderr, "svc_sendreply (1)\n");
 			abort();
 		}
 		break;
@@ -226,7 +293,7 @@
 		done:
 			if ((!svc_sendreply(xprt, xdr_long, (caddr_t)&ans)) &&
 			    debugging) {
-				fprintf(stderr, "svc_sendreply\n");
+				fprintf(stderr, "svc_sendreply (2)\n");
 				abort();
 			}
 		}
@@ -260,7 +327,7 @@
 			}
 			if ((!svc_sendreply(xprt, xdr_long, (caddr_t)&ans)) &&
 			    debugging) {
-				fprintf(stderr, "svc_sendreply\n");
+				fprintf(stderr, "svc_sendreply (3)\n");
 				abort();
 			}
 		}
@@ -280,7 +347,7 @@
 				port = 0;
 			if ((!svc_sendreply(xprt, xdr_long, (caddr_t)&port)) &&
 			    debugging) {
-				fprintf(stderr, "svc_sendreply\n");
+				fprintf(stderr, "svc_sendreply (4)\n");
 				abort();
 			}
 		}
@@ -295,7 +362,7 @@
 		else {
 			if ((!svc_sendreply(xprt, xdr_pmaplist,
 			    (caddr_t)&pmaplist)) && debugging) {
-				fprintf(stderr, "svc_sendreply\n");
+				fprintf(stderr, "svc_sendreply (5)\n");
 				abort();
 			}
 		}
@@ -324,7 +391,7 @@
  */
 #define ARGSIZE 9000
 
-typedef struct encap_parms {
+struct encap_parms {
 	u_long arglen;
 	char *args;
 };
@@ -338,7 +405,7 @@
 	return (xdr_bytes(xdrs, &(epp->args), &(epp->arglen), ARGSIZE));
 }
 
-typedef struct rmtcallargs {
+struct rmtcallargs {
 	u_long	rmt_prog;
 	u_long	rmt_vers;
 	u_long	rmt_port;
diff -bBwur a/etc/rpcinfo.c sunrpc-4.0.3-1/etc/rpcinfo.c
--- a/etc/rpcinfo.c	1989-07-11 21:48:44.000000000 +0200
+++ sunrpc-4.0.3-1/etc/rpcinfo.c	2007-09-05 21:30:09.000000000 +0200
@@ -49,11 +49,19 @@
 #include <rpc/pmap_clnt.h>
 #include <signal.h>
 #include <ctype.h>
+#include <getopt.h>
+
+#ifdef __CYGWIN__
+#include <unistd.h>
+#include <windows.h>
+#include <lmaccess.h>
+#include <lmapibuf.h>
+#endif /* __CYGWIN__ */
 
 #define MAXHOSTLEN 256
 
 #define	MIN_VERS	((u_long) 0)
-#define	MAX_VERS	((u_long) 4294967295L)
+#define	MAX_VERS	((u_long) 2147483647L)
 
 static void	udpping(/*u_short portflag, int argc, char **argv*/);
 static void	tcpping(/*u_short portflag, int argc, char **argv*/);
@@ -580,20 +588,51 @@
 	exit(0);
 }
 
+#ifdef __CYGWIN__
+
+PUSER_INFO_3
+GetPW(const char *user)
+{
+  WCHAR name[512];
+  DWORD ret;
+  PUSER_INFO_3 ui;
+
+  MultiByteToWideChar (CP_ACP, 0, user, -1, name, 512);
+  ret = NetUserGetInfo (NULL, name, 3, (PBYTE*) &ui);
+  return ret ? NULL : ui;
+}
+
+#endif /* __CYGWIN__ */
+
 static void
 deletereg(argc, argv)
 	int argc;
 	char **argv;
 {	u_long prog_num, version_num ;
 
+#ifdef __CYGWIN__
+	PUSER_INFO_3 pu;
+#endif /* __CYGWIN__ */
+
 	if (argc != 2) {
 		usage() ;
 		exit(1) ;
 	}
+
+#ifdef __CYGWIN__
+	if ((pu = GetPW(getlogin())) &&          /* This command allowed only */
+	    pu->usri3_priv != USER_PRIV_ADMIN) { /* to members of admin group */
+		fprintf(stderr, "Sorry. You don't have admin privileges\n") ;
+		NetApiBufferFree(pu);
+		exit(1) ;
+        }
+#else /* !__CYGWIN__ */
 	if (getuid()) { /* This command allowed only to root */
 		fprintf(stderr, "Sorry. You are not root\n") ;
 		exit(1) ;
 	}
+#endif /* __CYGWIN__ */
+
 	prog_num = getprognum(argv[0]);
 	version_num = getvers(argv[1]);
 	if ((pmap_unset(prog_num, version_num)) == 0) {
Only in sunrpc-4.0.3-1/man: CVS
Only in sunrpc-4.0.3-1/man: Makefile
Only in sunrpc-4.0.3-1/man/man1: CVS
Only in sunrpc-4.0.3-1/man/man3: CVS
Only in sunrpc-4.0.3-1/man/man5: CVS
Only in sunrpc-4.0.3-1/man/man8: CVS
Only in sunrpc-4.0.3-1/rpc: CVS
diff -bBwur a/rpc/Makefile sunrpc-4.0.3-1/rpc/Makefile
--- a/rpc/Makefile	1989-07-11 21:47:16.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/Makefile	2007-09-05 21:30:09.000000000 +0200
@@ -7,7 +7,7 @@
 DESTDIR=
 
 CPPFLAGS = -I..
-CFLAGS = -I..
+CFLAGS = -g -O2 -I..
 
 SRCS = auth_none.c auth_unix.c  authunix_prot.c bindresvport.c \
 	clnt_generic.c clnt_perror.c clnt_raw.c clnt_simple.c clnt_tcp.c \
@@ -38,15 +38,18 @@
 
 install: $(HDRS) librpclib.a
 	@echo "Creating RPC header directory"
-	-mkdir ${DESTDIR}/usr/include/rpc && \
-		chown bin ${DESTDIR}/usr/include/rpc && \
+	-mkdir -p ${DESTDIR}/usr/include/rpc && \
 		chmod 755 ${DESTDIR}/usr/include/rpc
 	@echo "Installing RPC header files"
 	-set -x;for i in $(HDRS) ; do \
 		(install -c -m 644 $$i ${DESTDIR}/usr/include/rpc) done
 	@echo "Installing RPC library"
+	@if [ -f ${DESTDIR}/usr/lib/librpclib.a ]; then rm -f ${DESTDIR}/usr/lib/librpclib.a; fi;
+	@mkdir -p ${DESTDIR}/usr/lib
 	install -c -m 644 librpclib.a ${DESTDIR}/usr/lib
 	ranlib ${DESTDIR}/usr/lib/librpclib.a
+	@if [ -L ${DESTDIR}/usr/lib/librpc.a ]; then rm -f ${DESTDIR}/usr/lib/librpc.a; fi;
+	ln -s ./librpclib.a ${DESTDIR}/usr/lib/librpc.a
 
 tags: $(SRCS) $(HDRS)
 	ctags -tw $(SRCS) $(HDRS)
@@ -55,11 +58,12 @@
 	sed 's,	/.*,,' tags | \
 	awk ' { printf("%-26s%-16s%s\n", $$1, $$2, $$3) }' > ref
 
+clean:  
+	rm -f *.o librpclib.a
+
 lint: $(SRCS) $(HDRS)
 	$(LINT.c) $(SRCS)
 
-clean: rm -f *.o rpclib.a
-
 .SUFFIXES: .x .x~
 
 .x.c:
diff -bBwur a/rpc/bindresvport.c sunrpc-4.0.3-1/rpc/bindresvport.c
--- a/rpc/bindresvport.c	1989-07-11 21:47:24.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/bindresvport.c	2007-09-05 21:30:09.000000000 +0200
@@ -72,7 +72,75 @@
 		if (port > ENDPORT) {
 			port = STARTPORT;
 		}
-		res = bind(sd, sin, sizeof(struct sockaddr_in));
+		res = bind(sd, (struct sockaddr *)sin, sizeof(struct sockaddr));
+	}
+	return (res);
+}
+
+bindcresvport(sd, family, type, protocol, sin, raddr, raddrlen)
+	int *sd;
+	int family;
+	int type;
+	int protocol;
+	struct sockaddr_in *sin;
+	struct sockaddr *raddr;
+	int raddrlen;
+{
+	int res;
+	static short port;
+	struct sockaddr_in myaddr;
+	extern int errno;
+	int i;
+
+#define STARTPORT 600
+#define ENDPORT (IPPORT_RESERVED - 1)
+#define NPORTS	(ENDPORT - STARTPORT + 1)
+
+	if (sin == (struct sockaddr_in *)0) {
+		sin = &myaddr;
+		bzero(sin, sizeof (*sin));
+		sin->sin_family = AF_INET;
+	} else if (sin->sin_family != AF_INET) {
+		errno = EPFNOSUPPORT;
+		return (-1);
+	}
+	if (port == 0) {
+		port = (getpid() % NPORTS) + STARTPORT;
+	}
+	for (i = 0; i < NPORTS; i++) {
+		sin->sin_port = htons(port++);
+		if (port > ENDPORT) {
+			port = STARTPORT;
+		}
+		res = socket(family, type, protocol);
+		if (res < 0) {
+			break;
+		}
+		*sd = res;
+		res = bind(*sd, (struct sockaddr *)sin, sizeof(struct sockaddr));
+		if (res < 0) {
+			if (errno == EADDRINUSE) {
+				close(*sd);
+				*sd = -1;
+				continue;
+			} else {
+				close(*sd);
+				*sd = -1;
+				break;
+			}
+		}
+		res = connect(*sd, raddr, raddrlen);
+		if (res >= 0) {
+			break;
+		}
+		if (errno == EADDRINUSE) {
+			close(*sd);
+			*sd = -1;
+		} else {
+			close(*sd);
+			*sd = -1;
+			break;
+		}
 	}
 	return (res);
 }
diff -bBwur a/rpc/clnt_perror.c sunrpc-4.0.3-1/rpc/clnt_perror.c
--- a/rpc/clnt_perror.c	1989-07-11 21:47:28.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/clnt_perror.c	2007-09-05 21:30:09.000000000 +0200
@@ -38,17 +38,14 @@
  *
  */
 #include <stdio.h>
+#include <string.h>
+#include <sys/errno.h>
 
 #include <rpc/types.h>
 #include <rpc/auth.h>
 #include <rpc/clnt.h>
 
-extern char *sys_errlist[];
-extern char *sprintf();
 static char *auth_errmsg();
-
-extern char *strcpy();
-
 static char *buf;
 
 static char *
@@ -229,8 +226,6 @@
 clnt_spcreateerror(s)
 	char *s;
 {
-	extern int sys_nerr;
-	extern char *sys_errlist[];
 	char *str = _buf();
 
 	if (str == 0)
diff -bBwur a/rpc/clnt_tcp.c sunrpc-4.0.3-1/rpc/clnt_tcp.c
--- a/rpc/clnt_tcp.c	1989-07-11 21:47:32.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/clnt_tcp.c	2007-09-05 21:30:09.000000000 +0200
@@ -61,6 +61,8 @@
 
 extern int errno;
 
+extern int bindcresvport(int *sd, int family, int type, int protocol, struct sockaddr_in *sin, struct sockaddr *raddr, int raddrlen);
+
 static int	readtcp();
 static int	writetcp();
 
@@ -152,6 +154,19 @@
 	 * If no socket given, open one
 	 */
 	if (*sockp < 0) {
+#ifdef __CYGWIN__
+		/* winsock will succeed in bindresvport(), but
+		   later fail in connect(), so I added a new function to
+		   combine both operations when finding a reserved port */
+		if (bindcresvport(sockp, AF_INET, SOCK_STREAM, IPPROTO_TCP,
+						  (struct sockaddr_in *)0,
+						  (struct sockaddr *)raddr, sizeof(*raddr)) < 0) {
+			rpc_createerr.cf_stat = RPC_SYSTEMERROR;
+			rpc_createerr.cf_error.re_errno = errno;
+			(void)close(*sockp);
+			goto fooy;
+		}
+#else
 		*sockp = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
 		(void)bindresvport(*sockp, (struct sockaddr_in *)0);
 		if ((*sockp < 0)
@@ -162,6 +177,7 @@
 			(void)close(*sockp);
 			goto fooy;
 		}
+#endif
 		ct->ct_closeit = TRUE;
 	} else {
 		ct->ct_closeit = FALSE;
@@ -415,7 +431,7 @@
 #endif /* def FD_SETSIZE */
 	while (TRUE) {
 		readfds = mask;
-		switch (select(_rpc_dtablesize(), &readfds, (int*)NULL, (int*)NULL,
+		switch (select(_rpc_dtablesize(), &readfds, (fd_set *)NULL, (fd_set *)NULL,
 			       &(ct->ct_wait))) {
 		case 0:
 			ct->ct_error.re_status = RPC_TIMEDOUT;
diff -bBwur a/rpc/clnt_udp.c sunrpc-4.0.3-1/rpc/clnt_udp.c
--- a/rpc/clnt_udp.c	1989-07-11 21:47:33.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/clnt_udp.c	2007-09-05 21:30:09.000000000 +0200
@@ -286,8 +286,8 @@
 #endif /* def FD_SETSIZE */
 	for (;;) {
 		readfds = mask;
-		switch (select(_rpc_dtablesize(), &readfds, (int *)NULL, 
-			       (int *)NULL, &(cu->cu_wait))) {
+		switch (select(_rpc_dtablesize(), &readfds, (fd_set *)NULL, 
+			       (fd_set *)NULL, &(cu->cu_wait))) {
 
 		case 0:
 			time_waited.tv_sec += cu->cu_wait.tv_sec;
diff -bBwur a/rpc/get_myaddress.c sunrpc-4.0.3-1/rpc/get_myaddress.c
--- a/rpc/get_myaddress.c	1989-07-11 21:47:35.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/get_myaddress.c	2007-09-05 21:30:09.000000000 +0200
@@ -80,8 +80,10 @@
 		    ifr->ifr_addr.sa_family == AF_INET) {
 			*addr = *((struct sockaddr_in *)&ifr->ifr_addr);
 			addr->sin_port = htons(PMAPPORT);
+			if (0 != addr->sin_addr.s_addr) {
 			break;
 		}
+		}
 		ifr++;
 	}
 	(void) close(s);
diff -bBwur a/rpc/getrpcent.c sunrpc-4.0.3-1/rpc/getrpcent.c
--- a/rpc/getrpcent.c	1989-07-11 21:47:36.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/getrpcent.c	2007-09-05 21:30:09.000000000 +0200
@@ -37,6 +37,7 @@
  */
 
 #include <stdio.h>
+#include <string.h>
 #include <sys/types.h>
 #include <rpc/rpc.h>
 #include <netdb.h>
@@ -55,12 +56,11 @@
 	struct	rpcent rpc;
 	char	line[BUFSIZ+1];
 	char	*domain;
-} *rpcdata, *_rpcdata();
+} *rpcdata;
 
 static	struct rpcent *interpret();
 struct	hostent *gethostent();
 char	*inet_ntoa();
-static	char *index();
 
 static char RPCDB[] = "/etc/rpc";
 
@@ -99,7 +99,7 @@
 
 struct rpcent *
 getrpcbyname(name)
-	char *name;
+ 	const char *name;
 {
 	struct rpcent *rpc;
 	char **rp;
@@ -117,6 +117,7 @@
 	return (NULL);
 }
 
+void
 setrpcent(f)
 	int f;
 {
@@ -134,6 +135,7 @@
 	d->stayopen |= f;
 }
 
+void
 endrpcent()
 {
 	register struct rpcdata *d = _rpcdata();
@@ -170,6 +172,8 @@
 
 static struct rpcent *
 interpret(val, len)
+	char *val;
+	int len;
 {
 	register struct rpcdata *d = _rpcdata();
 	char *p;
diff -bBwur a/rpc/pmap_rmt.c sunrpc-4.0.3-1/rpc/pmap_rmt.c
--- a/rpc/pmap_rmt.c	1989-07-11 21:47:49.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/pmap_rmt.c	2007-09-05 21:30:09.000000000 +0200
@@ -189,7 +189,7 @@
 #ifdef SIOCGIFBRDADDR   /* 4.3BSD */
 			if (ioctl(sock, SIOCGIFBRDADDR, (char *)&ifreq) < 0) {
 				addrs[i++] = inet_makeaddr(inet_netof
-			    (sin->sin_addr.s_addr), INADDR_ANY);
+			    (sin->sin_addr), INADDR_ANY);
 			} else {
 				addrs[i++] = ((struct sockaddr_in*)
 				  &ifreq.ifr_addr)->sin_addr;
@@ -319,8 +319,8 @@
 		msg.acpted_rply.ar_results.where = (caddr_t)&r;
                 msg.acpted_rply.ar_results.proc = xdr_rmtcallres;
 		readfds = mask;
-		switch (select(_rpc_dtablesize(), &readfds, (int *)NULL, 
-			       (int *)NULL, &t)) {
+		switch (select(_rpc_dtablesize(), &readfds, (fd_set *)NULL, 
+			       (fd_set *)NULL, &t)) {
 
 		case 0:  /* timed out */
 			stat = RPC_TIMEDOUT;
diff -bBwur a/rpc/rpc.h sunrpc-4.0.3-1/rpc/rpc.h
--- a/rpc/rpc.h	1989-07-11 21:47:52.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/rpc.h	2007-09-05 21:30:09.000000000 +0200
@@ -38,7 +38,6 @@
 #define __RPC_HEADER__
 
 #include <rpc/types.h>		/* some typedefs */
-#include <netinet/in.h>
 
 /* external data representation interfaces */
 #include <rpc/xdr.h>		/* generic (de)serializer */
@@ -56,7 +55,7 @@
  *  Uncomment-out the next line if you are building the rpc library with    
  *  DES Authentication (see the README file in the secure_rpc/ directory).
  */
-/*#include <rpc/auth_des.h>	/* protocol for des style cred */
+/*#include <rpc/auth_des.h>*/	/* protocol for des style cred */
 
 /* Server side only remote procedure callee */
 #include <rpc/svc.h>		/* service manager and multiplexer */
@@ -68,7 +67,7 @@
  * already have the structures defined by <rpc/netdb.h> included in <netdb.h>.
  */
 /* routines for parsing /etc/rpc */
-#ifndef sun
+#if !defined(sun) && !defined(__CYGWIN__)
 #include <rpc/netdb.h>		/* structures and routines to parse /etc/rpc */
 #endif
 
diff -bBwur a/rpc/rpc_dtablesize.c sunrpc-4.0.3-1/rpc/rpc_dtablesize.c
--- a/rpc/rpc_dtablesize.c	1989-07-11 21:47:55.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/rpc_dtablesize.c	2007-09-05 21:30:09.000000000 +0200
@@ -35,12 +35,21 @@
  * Cache the result of getdtablesize(), so we don't have to do an
  * expensive system call every time.
  */
+
+#ifdef __CYGWIN__
+#include <sys/types.h>
+#endif
+
 _rpc_dtablesize()
 {
+#ifdef __CYGWIN__
+	return (FD_SETSIZE);
+#else
 	static int size;
 	
 	if (size == 0) {
 		size = getdtablesize();
 	}
 	return (size);
+#endif
 }
diff -bBwur a/rpc/svc.h sunrpc-4.0.3-1/rpc/svc.h
--- a/rpc/svc.h	1989-07-11 21:48:01.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/svc.h	2007-09-05 21:30:09.000000000 +0200
@@ -151,7 +151,9 @@
  *	u_long prog;
  *	u_long vers;
  *	void (*dispatch)();
- *	int protocol;  /* like TCP or UDP, zero means do not register 
+ *	int protocol;
+ *
+ * protocol : like TCP or UDP, zero means do not register 
  */
 extern bool_t	svc_register();
 
@@ -277,4 +279,4 @@
 
 
 
-#endif !__SVC_HEADER__
+#endif /* !__SVC_HEADER__ */
diff -bBwur a/rpc/svc_run.c sunrpc-4.0.3-1/rpc/svc_run.c
--- a/rpc/svc_run.c	1989-07-11 21:48:07.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/svc_run.c	2007-09-05 21:30:09.000000000 +0200
@@ -55,7 +55,7 @@
 #else
 		readfds = svc_fds;
 #endif /* def FD_SETSIZE */
-		switch (select(_rpc_dtablesize(), &readfds, (int *)0, (int *)0,
+		switch (select(_rpc_dtablesize(), &readfds, (fd_set *)0, (fd_set *)0,
 			       (struct timeval *)0)) {
 		case -1:
 			if (errno == EINTR) {
diff -bBwur a/rpc/svc_tcp.c sunrpc-4.0.3-1/rpc/svc_tcp.c
--- a/rpc/svc_tcp.c	1989-07-11 21:48:10.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/svc_tcp.c	2007-09-05 21:30:09.000000000 +0200
@@ -304,7 +304,7 @@
 #endif /* def FD_SETSIZE */
 	do {
 		readfds = mask;
-		if (select(_rpc_dtablesize(), &readfds, (int*)NULL, (int*)NULL, 
+		if (select(_rpc_dtablesize(), &readfds, (fd_set *)NULL, (fd_set *)NULL, 
 			   &wait_per_try) <= 0) {
 			if (errno == EINTR) {
 				continue;
diff -bBwur a/rpc/svc_udp.c sunrpc-4.0.3-1/rpc/svc_udp.c
--- a/rpc/svc_udp.c	1989-07-11 21:48:11.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/svc_udp.c	2007-09-05 21:30:09.000000000 +0200
@@ -54,6 +54,8 @@
 static bool_t		svcudp_getargs();
 static bool_t		svcudp_freeargs();
 static void		svcudp_destroy();
+static void		cache_set();
+static int		cache_get();
 
 static struct xp_ops svcudp_op = {
 	svcudp_recv,
@@ -371,7 +373,7 @@
 /*
  * Set an entry in the cache
  */
-static
+static void
 cache_set(xprt, replylen)
 	SVCXPRT *xprt;
 	u_long replylen;	
@@ -436,7 +438,7 @@
  * Try to get an entry from the cache
  * return 1 if found, 0 if not found
  */
-static
+static int
 cache_get(xprt, msg, replyp, replylenp)
 	SVCXPRT *xprt;
 	struct rpc_msg *msg;
diff -bBwur a/rpc/types.h sunrpc-4.0.3-1/rpc/types.h
--- a/rpc/types.h	1989-07-11 21:48:12.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/types.h	2007-09-05 21:30:09.000000000 +0200
@@ -44,7 +44,7 @@
 #	define NULL 0
 #endif
 
-extern char *malloc();
+#include <malloc.h> 
 #define mem_alloc(bsize)	malloc(bsize)
 #define mem_free(ptr, bsize)	free(ptr)
 
@@ -52,6 +52,7 @@
 #include <sys/types.h>
 #endif
 #include <sys/time.h>
+#include <netinet/in.h>
 
 #ifndef INADDR_LOOPBACK
 #define       INADDR_LOOPBACK         (u_long)0x7F000001
diff -bBwur a/rpc/xdr.c sunrpc-4.0.3-1/rpc/xdr.c
--- a/rpc/xdr.c	1989-07-11 21:48:14.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/xdr.c	2007-09-05 21:30:09.000000000 +0200
@@ -42,7 +42,9 @@
  */
 
 #include <stdio.h>
-char *malloc();
+#include <stdlib.h>
+
+// char *malloc();
 
 #include <rpc/types.h>
 #include <rpc/xdr.h>
@@ -227,6 +229,79 @@
 	return (FALSE);
 }
 
+/*
+ * XDR 64-bit integers
+ */
+bool_t
+xdr_int64_t(xdrs, ip)
+	register XDR *xdrs;
+	int64_t *ip;
+{
+	if (sizeof (int64_t) <= sizeof (long)) {
+		return (xdr_long(xdrs, (long *)ip));
+	} else {
+		/* Assumes sizeof(long) == 4 */
+		int32_t t1;
+		u_int32_t t2;
+	
+		switch (xdrs->x_op) {
+			case XDR_ENCODE:
+				t1 = (int32_t) ((*ip) >> 32);
+				t2 = (int32_t) (*ip);
+				return (XDR_PUTLONG(xdrs, &t1) && XDR_PUTLONG(xdrs, &t2));
+	  
+			case XDR_DECODE:
+				if (!XDR_GETLONG(xdrs, &t1) || !XDR_GETLONG(xdrs, &t2))
+					return FALSE;
+				*ip = ((int64_t) t1) << 32;
+				*ip |= t2;
+				return TRUE;
+
+			case XDR_FREE:
+				return TRUE;
+
+			default:
+				return FALSE;
+		}
+	}
+}
+
+/*
+ * XDR unsigned 64-bit integers
+ */
+bool_t
+xdr_u_int64_t(xdrs, up)
+	register XDR *xdrs;
+	u_int64_t *up;
+{
+	if (sizeof (int64_t) <= sizeof (long)) {
+		return (xdr_long(xdrs, (long *)up));
+	} else {
+		/* Assumes sizeof(long) == 4 */
+		u_int32_t t1;
+		u_int32_t t2;
+	
+		switch (xdrs->x_op) {
+			case XDR_ENCODE:
+				t1 = (u_int32_t) ((*up) >> 32);
+				t2 = (u_int32_t) (*up);
+				return (XDR_PUTLONG(xdrs, &t1) && XDR_PUTLONG(xdrs, &t2));
+	  
+			case XDR_DECODE:
+				if (!XDR_GETLONG(xdrs, &t1) || !XDR_GETLONG(xdrs, &t2))
+					return FALSE;
+				*up = ((u_int64_t) t1) << 32;
+				*up |= t2;
+				return TRUE;
+
+			case XDR_FREE:
+				return TRUE;
+
+			default:
+				return FALSE;
+		}
+	}
+}
 
 /*
  * XDR a char
diff -bBwur a/rpc/xdr.h sunrpc-4.0.3-1/rpc/xdr.h
--- a/rpc/xdr.h	1989-07-11 21:48:15.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/xdr.h	2007-09-05 21:30:09.000000000 +0200
@@ -38,6 +38,12 @@
 #ifndef __XDR_HEADER__
 #define __XDR_HEADER__
 
+/* We need FILE.  */
+#include <stdio.h>
+#include <sys/cdefs.h>
+
+__BEGIN_DECLS
+
 /*
  * XDR provides a conventional way for converting between C data
  * types and an external bit-string representation.  Library supplied
@@ -95,31 +101,47 @@
  * allocate dynamic storage of the appropriate size and return it.
  * bool_t	(*xdrproc_t)(XDR *, caddr_t *);
  */
+
+// typedef bool_t (*xdrproc_t) (XDR *, void *,...);
 typedef	bool_t (*xdrproc_t)();
 
 /*
  * The XDR handle.
  * Contains operation which is being applied to the stream,
- * an operations vector for the paticular implementation (e.g. see xdr_mem.c),
- * and two private fields for the use of the particular impelementation.
+ * an operations vector for the particular implementation (e.g. see xdr_mem.c),
+ * and two private fields for the use of the particular implementation.
  */
-typedef struct {
+
+typedef struct XDR XDR;
+struct XDR
+  {
 	enum xdr_op	x_op;		/* operation; fast additional param */
-	struct xdr_ops {
-		bool_t	(*x_getlong)();	/* get a long from underlying stream */
-		bool_t	(*x_putlong)();	/* put a long to " */
-		bool_t	(*x_getbytes)();/* get some bytes from " */
-		bool_t	(*x_putbytes)();/* put some bytes to " */
-		u_int	(*x_getpostn)();/* returns bytes off from beginning */
-		bool_t  (*x_setpostn)();/* lets you reposition the stream */
-		long *	(*x_inline)();	/* buf quick ptr to buffered data */
-		void	(*x_destroy)();	/* free privates of this xdr_stream */
-	} *x_ops;
+    struct xdr_ops
+      {
+	bool_t (*x_getlong) (XDR *__xdrs, long *__lp);
+	/* get a long from underlying stream */
+	bool_t (*x_putlong) (XDR *__xdrs, __const long *__lp);
+	/* put a long to " */
+	bool_t (*x_getbytes) (XDR *__xdrs, caddr_t __addr, u_int __len);
+	/* get some bytes from " */
+	bool_t (*x_putbytes) (XDR *__xdrs, __const char *__addr, u_int __len);
+	/* put some bytes to " */
+	u_int (*x_getpostn) (__const XDR *__xdrs);
+	/* returns bytes off from beginning */
+	bool_t (*x_setpostn) (XDR *__xdrs, u_int __pos);
+	/* lets you reposition the stream */
+	long *(*x_inline) (XDR *__xdrs, u_int __len);
+	/* buf quick ptr to buffered data */
+	void (*x_destroy) (XDR *__xdrs);
+	/* free privates of this xdr_stream */
+      }
+     *x_ops;
 	caddr_t 	x_public;	/* users' data */
 	caddr_t		x_private;	/* pointer to private data */
 	caddr_t 	x_base;		/* private used for position info */
-	int		x_handy;	/* extra private word */
-} XDR;
+    u_int x_handy;		/* extra private word */
+  };
+
 
 /*
  * Operations defined on a XDR handle
@@ -166,11 +189,17 @@
 	(*(xdrs)->x_ops->x_inline)(xdrs, len)
 
 #define	XDR_DESTROY(xdrs)				\
+	do {							\
 	if ((xdrs)->x_ops->x_destroy) 			\
-		(*(xdrs)->x_ops->x_destroy)(xdrs)
+			(*(xdrs)->x_ops->x_destroy)(xdrs);	\
+	} while (0)
+
 #define	xdr_destroy(xdrs)				\
+	do {							\
 	if ((xdrs)->x_ops->x_destroy) 			\
-		(*(xdrs)->x_ops->x_destroy)(xdrs)
+			(*(xdrs)->x_ops->x_destroy)(xdrs);	\
+	} while (0)
+
 
 /*
  * Support struct for discriminated unions.
@@ -221,28 +250,37 @@
 /*
  * These are the "generic" xdr routines.
  */
-extern bool_t	xdr_void();
-extern bool_t	xdr_int();
-extern bool_t	xdr_u_int();
-extern bool_t	xdr_long();
-extern bool_t	xdr_u_long();
-extern bool_t	xdr_short();
-extern bool_t	xdr_u_short();
-extern bool_t	xdr_bool();
-extern bool_t	xdr_enum();
-extern bool_t	xdr_array();
-extern bool_t	xdr_bytes();
-extern bool_t	xdr_opaque();
-extern bool_t	xdr_string();
-extern bool_t	xdr_union();
-extern bool_t	xdr_char();
-extern bool_t	xdr_u_char();
-extern bool_t	xdr_vector();
-extern bool_t	xdr_float();
-extern bool_t	xdr_double();
-extern bool_t	xdr_reference();
-extern bool_t	xdr_pointer();
-extern bool_t	xdr_wrapstring();
+
+extern  bool_t xdr_void (void) ;
+extern  bool_t xdr_short (XDR *__xdrs, short *__sp) ;
+extern  bool_t xdr_u_short (XDR *__xdrs, u_short *__usp) ;
+extern  bool_t xdr_int (XDR *__xdrs, int *__ip) ;
+extern  bool_t xdr_u_int (XDR *__xdrs, u_int *__up) ;
+extern  bool_t xdr_long (XDR *__xdrs, long *__lp) ;
+extern  bool_t xdr_u_long (XDR *__xdrs, u_long *__ulp) ;
+extern  bool_t xdr_bool (XDR *__xdrs, bool_t *__bp) ;
+extern  bool_t xdr_enum (XDR *__xdrs, enum_t *__ep) ;
+extern  bool_t xdr_array (XDR * _xdrs, caddr_t *__addrp, u_int *__sizep,
+			 u_int __maxsize, u_int __elsize, xdrproc_t __elproc);
+extern  bool_t xdr_bytes (XDR *__xdrs, char **__cpp, u_int *__sizep,
+			 u_int __maxsize) ;
+extern  bool_t xdr_opaque (XDR *__xdrs, caddr_t __cp, u_int __cnt) ;
+extern  bool_t xdr_string (XDR *__xdrs, char **__cpp, u_int __maxsize) ;
+extern  bool_t xdr_union (XDR *__xdrs, enum_t *__dscmp, char *__unp,
+			 struct xdr_discrim *__choices,
+			 xdrproc_t dfault) ;
+extern  bool_t xdr_char (XDR *__xdrs, char *__cp) ;
+extern  bool_t xdr_u_char (XDR *__xdrs, char *__cp) ;
+extern  bool_t xdr_vector (XDR *__xdrs, char *__basep, u_int __nelem,
+			  u_int __elemsize, xdrproc_t __xdr_elem) ;
+extern  bool_t xdr_float (XDR *__xdrs, float *__fp) ;
+extern  bool_t xdr_double (XDR *__xdrs, double *__dp) ;
+extern  bool_t xdr_reference (XDR *__xdrs, caddr_t *__xpp, u_int __size,
+			     xdrproc_t __proc) ;
+extern  bool_t xdr_pointer (XDR *__xdrs, char **__objpp,
+			   u_int __obj_size, xdrproc_t __xdr_obj) ;
+extern  bool_t xdr_wrapstring (XDR *__xdrs, char **__cpp) ;
+
 
 /*
  * Common opaque bytes objects used by many rpc protocols;
@@ -254,17 +292,38 @@
 	char	*n_bytes;
 };
 typedef struct netobj netobj;
-extern bool_t   xdr_netobj();
+extern  bool_t   xdr_netobj (XDR *__xdrs, struct netobj *__np);
 
 /*
  * These are the public routines for the various implementations of
  * xdr streams.
  */
-extern void   xdrmem_create();		/* XDR using memory buffers */
-extern void   xdrstdio_create();	/* XDR using stdio library */
-extern void   xdrrec_create();		/* XDR pseudo records for tcp */
-extern bool_t xdrrec_endofrecord();	/* make end of xdr record */
-extern bool_t xdrrec_skiprecord();	/* move to beginning of next record */
-extern bool_t xdrrec_eof();		/* true if no more input */
 
-#endif !__XDR_HEADER__
+/* XDR using memory buffers */
+extern  void xdrmem_create (XDR *__xdrs, __const caddr_t __addr,
+			   u_int __size, enum xdr_op __xop) ;
+
+/* XDR using stdio library */
+extern  void xdrstdio_create (XDR *__xdrs, FILE *__file, enum xdr_op __xop);
+
+/* XDR pseudo records for tcp */
+extern  void xdrrec_create (XDR *__xdrs, u_int __sendsize,
+			   u_int __recvsize, caddr_t __tcp_handle,
+			   int (*__readit) (char *, char *, int),
+			   int (*__writeit) (char *, char *, int)) ;
+
+/* make end of xdr record */
+extern  bool_t xdrrec_endofrecord (XDR *__xdrs, bool_t __sendnow) ;
+
+/* move to beginning of next record */
+extern  bool_t xdrrec_skiprecord (XDR *__xdrs) ;
+
+/* true if no more input */
+extern  bool_t xdrrec_eof (XDR *__xdrs) ;
+
+/* free memory buffers for xdr */
+extern  void xdr_free (xdrproc_t __proc, char *__objp) ;
+
+__END_DECLS
+
+#endif /* !__XDR_HEADER__ */
diff -bBwur a/rpc/xdr_float.c sunrpc-4.0.3-1/rpc/xdr_float.c
--- a/rpc/xdr_float.c	1989-07-11 21:48:18.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/xdr_float.c	2007-09-05 21:30:09.000000000 +0200
@@ -46,6 +46,14 @@
 #include <rpc/types.h>
 #include <rpc/xdr.h>
 
+#if defined(mc68000) || defined(sparc)
+#define BIGENDIAN 1
+#endif
+
+#if defined(i386) || defined(__CYGWIN__)
+#define BIGENDIAN 0
+#endif
+
 /*
  * NB: Not portable.
  * This routine works on Suns (Sky / 68000's) and Vaxen.
@@ -87,7 +95,7 @@
 	register XDR *xdrs;
 	register float *fp;
 {
-#if !defined(mc68000) && !defined(sparc)
+#if !defined(mc68000) && !defined(sparc) && !defined(__CYGWIN__) && !defined(i386)
 	struct ieee_single is;
 	struct vax_single vs, *vsp;
 	struct sgl_limits *lim;
@@ -96,7 +104,7 @@
 	switch (xdrs->x_op) {
 
 	case XDR_ENCODE:
-#if defined(mc68000) || defined(sparc)
+#if defined(mc68000) || defined(sparc) || defined(__CYGWIN__) || defined(i386)
 		return (XDR_PUTLONG(xdrs, (long *)fp));
 #else
 		vs = *((struct vax_single *)fp);
@@ -118,7 +126,7 @@
 #endif
 
 	case XDR_DECODE:
-#if defined(mc68000) || defined(sparc)
+#if defined(mc68000) || defined(sparc) || defined(__CYGWIN__) || defined(i386)
 		return (XDR_GETLONG(xdrs, (long *)fp));
 #else
 		vsp = (struct vax_single *)fp;
@@ -193,7 +201,7 @@
 	double *dp;
 {
 	register long *lp;
-#if !defined(mc68000) && !defined(sparc)
+#if !defined(mc68000) && !defined(sparc) && !defined(__CYGWIN__) && !defined(i386)
 	struct	ieee_double id;
 	struct	vax_double vd;
 	register struct dbl_limits *lim;
@@ -203,8 +211,15 @@
 	switch (xdrs->x_op) {
 
 	case XDR_ENCODE:
-#if defined(mc68000) || defined(sparc)
+#if defined(mc68000) || defined(sparc) || defined(__CYGWIN__) || defined(i386)
 		lp = (long *)dp;
+
+#if BIGENDIAN
+		return (XDR_PUTLONG(xdrs, lp++) && XDR_PUTLONG(xdrs, lp));
+#else
+		return (XDR_PUTLONG(xdrs, lp+1) && XDR_PUTLONG(xdrs, lp));
+#endif
+
 #else
 		vd = *((struct vax_double *)dp);
 		for (i = 0, lim = dbl_limits;
@@ -227,14 +242,20 @@
 	shipit:
 		id.sign = vd.sign;
 		lp = (long *)&id;
-#endif
 		return (XDR_PUTLONG(xdrs, lp++) && XDR_PUTLONG(xdrs, lp));
+#endif
 
 	case XDR_DECODE:
-#if defined(mc68000) || defined(sparc)
+#if defined(mc68000) || defined(sparc) || defined(__CYGWIN__) || defined(i386)
 		lp = (long *)dp;
+
+#if BIGENDIAN
 		return (XDR_GETLONG(xdrs, lp++) && XDR_GETLONG(xdrs, lp));
 #else
+		return (XDR_GETLONG(xdrs, lp+1) && XDR_GETLONG(xdrs, lp));
+#endif
+
+#else
 		lp = (long *)&id;
 		if (!XDR_GETLONG(xdrs, lp++) || !XDR_GETLONG(xdrs, lp))
 			return (FALSE);
diff -bBwur a/rpc/xdr_rec.c sunrpc-4.0.3-1/rpc/xdr_rec.c
--- a/rpc/xdr_rec.c	1989-07-11 21:48:21.000000000 +0200
+++ sunrpc-4.0.3-1/rpc/xdr_rec.c	2007-09-05 21:30:09.000000000 +0200
@@ -65,6 +65,10 @@
 static bool_t	xdrrec_setpos();
 static long *	xdrrec_inline();
 static void	xdrrec_destroy();
+static bool_t	flush_out();
+static bool_t	get_input_bytes();
+static bool_t	set_input_fragment();
+static bool_t	skip_input_bytes();
 
 static struct  xdr_ops xdrrec_ops = {
 	xdrrec_getlong,
Only in sunrpc-4.0.3-1/rpcgen: CVS
diff -bBwur a/rpcgen/Makefile sunrpc-4.0.3-1/rpcgen/Makefile
--- a/rpcgen/Makefile	1989-07-11 21:46:20.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/Makefile	2007-09-05 21:30:09.000000000 +0200
@@ -10,8 +10,9 @@
 OBJS= rpc_main.o rpc_hout.o rpc_cout.o rpc_parse.o rpc_scan.o rpc_util.o \
 	rpc_svcout.o rpc_clntout.o
 
-GOAL=rpcgen
-CFLAGS = -O
+EXT = .exe
+GOAL=rpcgen$(EXT)
+CFLAGS = -g -O2
 DESTDIR=
 
 $(GOAL): $(OBJS)
@@ -19,6 +20,7 @@
 
 install: $(GOAL)
 	@echo "Installing the RPC Protocol Compiler"
+	@mkdir -p $(DESTDIR)/usr/bin
 	install -s $(GOAL) $(DESTDIR)/usr/bin
 
 lint: $(SRCS) $(HDRS)
diff -bBwur a/rpcgen/rpc_clntout.c sunrpc-4.0.3-1/rpcgen/rpc_clntout.c
--- a/rpcgen/rpc_clntout.c	1989-07-11 21:46:21.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_clntout.c	2007-09-05 21:30:09.000000000 +0200
@@ -42,6 +42,9 @@
 
 #define DEFAULT_TIMEOUT 25	/* in seconds */
 
+static void	write_program();
+static void	printbody();
+
 void
 write_stubs()
 {
@@ -61,7 +64,7 @@
 }
 
 
-static
+static void
 write_program(def)
 	definition *def;
 {
@@ -97,7 +100,7 @@
 	}
 }
 
-static
+static void
 printbody(proc)
 	proc_list *proc;
 {
diff -bBwur a/rpcgen/rpc_cout.c sunrpc-4.0.3-1/rpcgen/rpc_cout.c
--- a/rpcgen/rpc_cout.c	1989-07-11 21:46:22.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_cout.c	2007-09-05 21:30:09.000000000 +0200
@@ -40,6 +40,15 @@
 #include "rpc_util.h"
 #include "rpc_parse.h"
 
+static print_header();
+static print_trailer();
+static space();
+static emit_enum();
+static emit_union();
+static emit_struct();
+static emit_typedef();
+static print_stat();
+
 /*
  * Emit the C-routine for the given definition 
  */
diff -bBwur a/rpcgen/rpc_hout.c sunrpc-4.0.3-1/rpcgen/rpc_hout.c
--- a/rpcgen/rpc_hout.c	1989-07-11 21:46:23.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_hout.c	2007-09-05 21:30:09.000000000 +0200
@@ -40,6 +40,15 @@
 #include "rpc_util.h"
 #include "rpc_parse.h"
 
+static pconstdef();
+static pstructdef();
+static puniondef();
+static pdefine();
+static pprogramdef();
+static penumdef();
+static ptypedef();
+static pdeclaration();
+static undefined2();
 
 /*
  * Print the C-version of an xdr definition 
diff -bBwur a/rpcgen/rpc_main.c sunrpc-4.0.3-1/rpcgen/rpc_main.c
--- a/rpcgen/rpc_main.c	1989-07-11 21:46:25.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_main.c	2007-09-05 21:30:09.000000000 +0200
@@ -43,6 +43,13 @@
 #include "rpc_parse.h"
 #include "rpc_scan.h"
 
+static c_output();
+static h_output();
+static s_output();
+static l_output();
+static do_registers();
+static parseargs();
+
 #define EXTEND	1		/* alias for TRUE */
 
 struct commandline {
@@ -56,7 +63,13 @@
 };
 
 static char *cmdname;
+
+#ifdef __CYGWIN__
+static char CPP[] = "/bin/cpp";
+#else
 static char CPP[] = "/lib/cpp";
+#endif
+
 static char CPPFLAGS[] = "-C";
 static char *allv[] = {
 	"rpcgen", "-s", "udp", "-s", "tcp",
diff -bBwur a/rpcgen/rpc_parse.c sunrpc-4.0.3-1/rpcgen/rpc_parse.c
--- a/rpcgen/rpc_parse.c	1989-07-11 21:46:26.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_parse.c	2007-09-05 21:30:09.000000000 +0200
@@ -40,6 +40,17 @@
 #include "rpc_scan.h"
 #include "rpc_parse.h"
 
+static isdefined();
+static def_struct();
+static def_program();
+static def_enum();
+static def_const();
+static def_union();
+static def_typedef();
+static get_declaration();
+static get_type();
+static unsigned_dec();
+
 /*
  * return the next definition you see
  */
@@ -365,6 +376,10 @@
 		*typep = "long";
 		(void) peekscan(TOK_INT, &tok);
 		break;
+	case TOK_HYPER:
+		*typep = "int64_t";
+		(void) peekscan(TOK_INT, &tok);
+		break;
 	case TOK_VOID:
 		if (dkind != DEF_UNION && dkind != DEF_PROGRAM) {
 			error("voids allowed only inside union and program definitions");
@@ -408,6 +423,11 @@
 		*typep = "u_long";
 		(void) peekscan(TOK_INT, &tok);
 		break;
+	case TOK_HYPER:
+		get_token(&tok);
+		*typep = "u_int64_t";
+		(void) peekscan(TOK_INT, &tok);
+		break;
 	case TOK_INT:
 		get_token(&tok);
 		*typep = "u_int";
diff -bBwur a/rpcgen/rpc_scan.c sunrpc-4.0.3-1/rpcgen/rpc_scan.c
--- a/rpcgen/rpc_scan.c	1989-07-11 21:46:29.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_scan.c	2007-09-05 21:30:09.000000000 +0200
@@ -41,6 +41,15 @@
 #include "rpc_scan.h"
 #include "rpc_util.h"
 
+static unget_token();
+static findstrconst();
+static findconst();
+static findkind();
+static cppline();
+static directive();
+static printdirective();
+static docppline();
+
 #define startcomment(where) (where[0] == '/' && where[1] == '*')
 #define endcomment(where) (where[-1] == '*' && where[0] == '/')
 
@@ -371,6 +380,7 @@
 			  {TOK_UNSIGNED, "unsigned"},
 			  {TOK_SHORT, "short"},
 			  {TOK_LONG, "long"},
+			  {TOK_HYPER, "hyper"},
 			  {TOK_FLOAT, "float"},
 			  {TOK_DOUBLE, "double"},
 			  {TOK_STRING, "string"},
diff -bBwur a/rpcgen/rpc_scan.h sunrpc-4.0.3-1/rpcgen/rpc_scan.h
--- a/rpcgen/rpc_scan.h	1989-07-11 21:46:30.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_scan.h	2007-09-05 21:30:09.000000000 +0200
@@ -64,6 +64,7 @@
 	TOK_INT,
 	TOK_SHORT,
 	TOK_LONG,
+	TOK_HYPER,
 	TOK_UNSIGNED,
 	TOK_FLOAT,
 	TOK_DOUBLE,
diff -bBwur a/rpcgen/rpc_svcout.c sunrpc-4.0.3-1/rpcgen/rpc_svcout.c
--- a/rpcgen/rpc_svcout.c	1989-07-11 21:46:31.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_svcout.c	2007-09-05 21:30:09.000000000 +0200
@@ -40,6 +40,10 @@
 #include "rpc_parse.h"
 #include "rpc_util.h"
 
+static write_program();
+static printerr();
+static printif();
+
 static char RQSTP[] = "rqstp";
 static char TRANSP[] = "transp";
 static char ARG[] = "argument";
diff -bBwur a/rpcgen/rpc_util.c sunrpc-4.0.3-1/rpcgen/rpc_util.c
--- a/rpcgen/rpc_util.c	1989-07-11 21:46:33.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_util.c	2007-09-05 21:30:09.000000000 +0200
@@ -40,6 +40,8 @@
 #include "rpc_parse.h"
 #include "rpc_util.h"
 
+static printwhere();
+
 char curline[MAXLINESIZE];	/* current read line */
 char *where = curline;	/* current point in line */
 int linenum = 0;	/* current line number */
@@ -365,6 +367,7 @@
 			     {TOK_INT, "int"},
 			     {TOK_SHORT, "short"},
 			     {TOK_LONG, "long"},
+			     {TOK_HYPER, "hyper"},
 			     {TOK_UNSIGNED, "unsigned"},
 			     {TOK_DOUBLE, "double"},
 			     {TOK_FLOAT, "float"},
diff -bBwur a/rpcgen/rpc_util.h sunrpc-4.0.3-1/rpcgen/rpc_util.h
--- a/rpcgen/rpc_util.h	1989-07-11 21:46:34.000000000 +0200
+++ sunrpc-4.0.3-1/rpcgen/rpc_util.h	2007-09-05 21:30:09.000000000 +0200
@@ -38,8 +38,6 @@
 #define alloc(size)		malloc((unsigned)(size))
 #define ALLOC(object)   (object *) malloc(sizeof(object))
 
-extern char *sprintf();
-
 #define s_print	(void) sprintf
 #define f_print (void) fprintf
 
Only in sunrpc-4.0.3-1/rpcsvc: CVS
diff -bBwur a/rpcsvc/Makefile sunrpc-4.0.3-1/rpcsvc/Makefile
--- a/rpcsvc/Makefile	1989-07-11 21:48:50.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/Makefile	2007-09-05 21:30:09.000000000 +0200
@@ -2,48 +2,52 @@
 # @(#)Makefile	2.3 88/08/11 4.0 RPCSRC
 #
 #
-RPCCOM = rpcgen
+RPCCOM = $(DESTDIR)/usr/bin/rpcgen
 LIB = -lrpclib
 
 DESTDIR=
-CFLAGS= -O
+CFLAGS= -g -O2
 LDFLAGS=
 
-HDRS= klm_prot.h mount.h nfs_prot.h nlm_prot.h rex.h rquota.h rnusers.h\
+HDRS= key_prot.h klm_prot.h mount.h nfs_prot.h nlm_prot.h rex.h rquota.h rusers.h\
       rquota.h rstat.h sm_inter.h spray.h yppasswd.h yp.h
-XFILES= bootparam_prot.x klm_prot.x mount.x nfs_prot.x nlm_prot.x \
-      rex.x rnusers.x rquota.x rstat.x sm_inter.x spray.x yppasswd.x yp.x
-BIN= rstat
-SVCBIN= rstat_svc
+XFILES= bootparam_prot.x key_prot.x klm_prot.x mount.x nfs_prot.x nlm_prot.x \
+      rex.x rusers.x rquota.x rstat.x sm_inter.x spray.x yppasswd.x yp.x
+EXT=.exe
+BIN= rstat${EXT}
+#SVCBIN= rstat_svc${EXT}
+SVCBIN=
 GEN= rstat_clnt.c rstat_svc.c rstat_xdr.c
 
 all:	$(HDRS) $(BIN) $(SVCBIN)
 
 install: $(HDRS) $(XFILES)
 	@echo "Creating RPC service headers directory"
-	-mkdir ${DESTDIR}/usr/include/rpcsvc && \
-		chown bin ${DESTDIR}/usr/include/rpcsvc && \
+	-mkdir -p ${DESTDIR}/usr/include/rpcsvc && \
 		chmod 755 ${DESTDIR}/usr/include/rpcsvc
 	@echo "Installing RPC service header and definition files"
 	for i in $(HDRS) $(XFILES); do \
 		(install -c -m 644 $$i ${DESTDIR}/usr/include/rpcsvc) done
-	-mkdir ${DESTDIR}/etc && chown bin ${DESTDIR}/etc && \
+	-mkdir -p ${DESTDIR}/etc && \
 		chmod 755 ${DESTDIR}/etc
-	@echo "Installing ${SVCBIN} in ${DESTDIR}/etc"
-	@set -x;for i in ${SVCBIN}; do \
-		(install -c -s $$i ${DESTDIR}/etc/$$i); done
+	@if [ "${SVCBIN}" != "" ]; then \
+		echo "Installing ${SVCBIN} in ${DESTDIR}/etc"; \
+		install -c -s ${SVCBIN} ${DESTDIR}/usr/sbin/${SVCBIN}; \
+	fi;
 	@echo "Installing ${BIN} in ${DESTDIR}/usr/bin"
-	@set -x;for i in ${BIN}; do \
-		(install -c -s $$i ${DESTDIR}/usr/bin/$$i); done
+	@mkdir -p ${DESTDIR}/usr/bin
+	install -c -s ${BIN} ${DESTDIR}/usr/bin/${BIN}
 
-rstat_svc: rstat_proc.o rstat_svc.o rstat_xdr.o
-	$(CC) $(LDFLAGS) -o $@ rstat_proc.o rstat_svc.o rstat_xdr.o $(LIB)
+${SVCBIN}: rstat_proc.o rstat_svc.o rstat_xdr.o
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ rstat_proc.o rstat_svc.o rstat_xdr.o $(LIB)
 
-rstat: rstat.o rstat_clnt.o rstat_xdr.o
-	$(CC) $(LDFLAGS) -o $@ rstat.o rstat_clnt.o rstat_xdr.o $(LIB)
+${BIN}: rstat.o rstat_clnt.o rstat_xdr.o
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ rstat.o rstat_clnt.o rstat_xdr.o $(LIB)
 
 rstat.c rstat_proc.c:	rstat.h
 
+key_prot.h:	key_prot.x
+	$(RPCCOM) -h key_prot.x -o $@
 klm_prot.h:	klm_prot.x
 	$(RPCCOM) -h klm_prot.x -o $@
 mount.h:	mount.x
@@ -54,8 +58,8 @@
 	$(RPCCOM) -h nlm_prot.x -o $@
 rex.h:	rex.x
 	$(RPCCOM) -h rex.x -o $@
-rnusers.h:	rnusers.x
-	$(RPCCOM) -h rnusers.x -o $@
+rusers.h:	rusers.x
+	$(RPCCOM) -h rusers.x -o $@
 rquota.h:	rquota.x
 	$(RPCCOM) -h rquota.x -o $@
 rstat.h:	rstat.x
@@ -77,4 +81,4 @@
 	$(RPCCOM) -c rstat.x -o $@
 
 clean cleanup:
-	rm -f *.o $(GEN) $(BIN) $(SVCBIN)
+	rm -f *.o $(GEN) $(HDRS) $(BIN) $(SVCBIN)
diff -bBwur a/rpcsvc/bootparam_prot.x sunrpc-4.0.3-1/rpcsvc/bootparam_prot.x
--- a/rpcsvc/bootparam_prot.x	1989-07-11 21:48:51.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/bootparam_prot.x	2007-09-05 21:30:09.000000000 +0200
@@ -41,6 +41,11 @@
  */
 
 #ifdef RPC_HDR
+%#ifndef _rpcsvc_bootparam_prot_h
+%#define _rpcsvc_bootparam_prot_h
+#endif
+
+#ifdef RPC_HDR
 %#include <rpc/types.h>
 %#include <sys/time.h>
 %#include <sys/errno.h>
@@ -95,3 +100,7 @@
 		bp_getfile_res	BOOTPARAMPROC_GETFILE(bp_getfile_arg) = 2;
 	} = 1;
 } = 100026;
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_bootparam_prot_h*/
+#endif
Only in sunrpc-4.0.3-1/rpcsvc: key_prot.x
diff -bBwur a/rpcsvc/klm_prot.x sunrpc-4.0.3-1/rpcsvc/klm_prot.x
--- a/rpcsvc/klm_prot.x	1989-07-11 21:48:53.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/klm_prot.x	2007-09-05 21:30:09.000000000 +0200
@@ -38,21 +38,11 @@
  * local lock manager.  The local lock manager is a deamon running
  * above the kernel.
  */
-program KLM_PROG {
-	version KLM_VERS {
-
-		klm_testrply	KLM_TEST (struct klm_testargs) =	1;
-
-		klm_stat	KLM_LOCK (struct klm_lockargs) =	2;
-
-		klm_stat	KLM_CANCEL (struct klm_lockargs) =	3;
-		/* klm_granted=> the cancel request fails due to lock is already granted */
-		/* klm_denied=> the cancel request successfully aborts
-lock request  */
 
-		klm_stat	KLM_UNLOCK (struct klm_unlockargs) =	4;
-	} = 1;
-} = 100020;
+#ifdef RPC_HDR
+%#ifndef _rpcsvc_klm_prot_h
+%#define _rpcsvc_klm_prot_h
+#endif
 
 const	LM_MAXSTRLEN = 1024;
 
@@ -130,3 +120,24 @@
 struct klm_unlockargs {
 	struct klm_lock alock;
 };
+
+program KLM_PROG {
+	version KLM_VERS {
+
+		klm_testrply	KLM_TEST (struct klm_testargs) =	1;
+
+		klm_stat	KLM_LOCK (struct klm_lockargs) =	2;
+
+		klm_stat	KLM_CANCEL (struct klm_lockargs) =	3;
+		/* klm_granted=> the cancel request fails due to lock is already granted */
+		/* klm_denied=> the cancel request successfully aborts
+lock request  */
+
+		klm_stat	KLM_UNLOCK (struct klm_unlockargs) =	4;
+	} = 1;
+} = 100020;
+
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_klm_prot_h*/
+#endif
diff -bBwur a/rpcsvc/mount.x sunrpc-4.0.3-1/rpcsvc/mount.x
--- a/rpcsvc/mount.x	1989-07-11 21:48:54.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/mount.x	2007-09-05 21:30:09.000000000 +0200
@@ -34,6 +34,10 @@
  * Protocol description for the mount program
  */
 
+#ifdef RPC_HDR
+%#ifndef _rpcsvc_mount_h
+%#define _rpcsvc_mount_h
+#endif
 
 const MNTPATHLEN = 1024;	/* maximum bytes in a pathname argument */
 const MNTNAMLEN = 255;		/* maximum bytes in a name argument */
@@ -98,6 +102,21 @@
 	exports ex_next;
 };
 
+/*
+ * POSIX pathconf information
+ */
+struct pathcnf {
+	int	pc_link_max;	/* max links allowed */
+	short	pc_max_canon;	/* max line len for a tty */
+	short	pc_max_input;	/* input a tty can eat all at once */
+	short	pc_name_max;	/* max file name length (dir entry) */
+	short	pc_path_max;	/* max path name length (/x/y/x/.. ) */
+	short	pc_pipe_buf;	/* size of a pipe (bytes) */
+	u_char	pc_vdisable;	/* safe char to turn off c_cc[i] */
+	char	pc_xxx;		/* alignment padding; cc_t == char */
+	short	pc_mask[2];	/* validity and boolean bits */
+};
+
 program MOUNTPROG {
 	/*
 	 * Version one of the mount protocol communicates with version two
@@ -107,7 +126,7 @@
 	version MOUNTVERS {
 		/*
 		 * Does no work. It is made available in all RPC services
-		 * to allow server reponse testing and timing
+		 * to allow server response testing and timing
 		 */
 		void
 		MOUNTPROC_NULL(void) = 0;
@@ -158,4 +177,76 @@
 		exports
 		MOUNTPROC_EXPORTALL(void) = 6;
 	} = 1;
+
+	/*
+	 * Version two of the mount protocol communicates with version two
+	 * of the NFS protocol.
+	 * The only difference from version one is the addition of a POSIX
+	 * pathconf call.
+	 */
+	version MOUNTVERS_POSIX {
+		/*
+		 * Does no work. It is made available in all RPC services
+		 * to allow server reponse testing and timing
+		 */
+		void
+		MOUNTPROC_NULL(void) = 0;
+
+		/*	
+		 * If fhs_status is 0, then fhs_fhandle contains the
+	 	 * file handle for the directory. This file handle may
+		 * be used in the NFS protocol. This procedure also adds
+		 * a new entry to the mount list for this client mounting
+		 * the directory.
+		 * Unix authentication required.
+		 */
+		fhstatus 
+		MOUNTPROC_MNT(dirpath) = 1;
+
+		/*
+		 * Returns the list of remotely mounted filesystems. The 
+		 * mountlist contains one entry for each hostname and 
+		 * directory pair.
+		 */
+		mountlist
+		MOUNTPROC_DUMP(void) = 2;
+
+		/*
+		 * Removes the mount list entry for the directory
+		 * Unix authentication required.
+		 */
+		void
+		MOUNTPROC_UMNT(dirpath) = 3;
+
+		/*
+		 * Removes all of the mount list entries for this client
+		 * Unix authentication required.
+		 */
+		void
+		MOUNTPROC_UMNTALL(void) = 4;
+
+		/*
+		 * Returns a list of all the exported filesystems, and which
+		 * machines are allowed to import it.
+		 */
+		exports
+		MOUNTPROC_EXPORT(void)  = 5;
+
+		/*
+		 * Identical to MOUNTPROC_EXPORT above
+		 */
+		exports
+		MOUNTPROC_EXPORTALL(void) = 6;
+
+		/*
+		 * POSIX pathconf info (Sun hack)
+		 */
+		pathcnf
+		MOUNTPROC_PATHCONF(dirpath) = 7;
+	} = 2;
+
 } = 100005;
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_mount_h*/
+#endif
diff -bBwur a/rpcsvc/nfs_prot.x sunrpc-4.0.3-1/rpcsvc/nfs_prot.x
--- a/rpcsvc/nfs_prot.x	1989-07-11 21:48:56.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/nfs_prot.x	2007-09-05 21:30:09.000000000 +0200
@@ -33,6 +33,12 @@
  * nfs_prot.x 1.2 87/10/12
  * Copyright 1987 Sun Microsystems, Inc.
  */
+
+#ifdef RPC_HDR
+%#ifndef _rpcsvc_nfs_prot_h
+%#define _rpcsvc_nfs_prot_h
+#endif
+
 const NFS_PORT          = 2049;
 const NFS_MAXDATA       = 8192;
 const NFS_MAXPATHLEN    = 1024;
@@ -67,6 +73,7 @@
 	NFSERR_NODEV=19,	/* No such device */
 	NFSERR_NOTDIR=20,	/* Not a directory*/
 	NFSERR_ISDIR=21,	/* Is a directory */
+	NFSERR_INVAL=22,	/* invalid argument */
 	NFSERR_FBIG=27,		/* File too large */
 	NFSERR_NOSPC=28,	/* No space left on device */
 	NFSERR_ROFS=30,		/* Read-only file system */
@@ -118,7 +125,7 @@
 	unsigned uid;		/* owner user id */
 	unsigned gid;		/* owner group id */
 	unsigned size;		/* file size in bytes */
-	unsigned blocksize;	/* prefered block size */
+	unsigned blocksize;	/* preferred block size */
 	unsigned rdev;		/* special device # */
 	unsigned blocks;	/* Kb of disk used by file */
 	unsigned fsid;		/* device # */
@@ -353,3 +360,6 @@
 	} = 2;
 } = 100003;
 
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_nfs_prot_h*/
+#endif
diff -bBwur a/rpcsvc/nlm_prot.x sunrpc-4.0.3-1/rpcsvc/nlm_prot.x
--- a/rpcsvc/nlm_prot.x	1989-07-11 21:48:57.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/nlm_prot.x	2007-09-05 21:30:09.000000000 +0200
@@ -9,6 +9,11 @@
  */
 
 #ifdef RPC_HDR
+%#ifndef _rpcsvc_nlm_prot_h
+%#define _rpcsvc_nlm_prot_h
+#endif
+
+#ifdef RPC_HDR
 %#define LM_MAXSTRLEN	1024
 %#define MAXNAMELEN	LM_MAXSTRLEN+1
 #endif
@@ -177,3 +182,7 @@
 
 } = 100021;
 
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_nlm_prot_h*/
+#endif
diff -bBwur a/rpcsvc/rex.x sunrpc-4.0.3-1/rpcsvc/rex.x
--- a/rpcsvc/rex.x	1989-07-11 21:48:58.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/rex.x	2007-09-05 21:30:09.000000000 +0200
@@ -34,6 +34,11 @@
  * Remote execution (rex) protocol specification
  */
 
+#ifdef RPC_HDR
+%#ifndef _rpcsvc_rex_h
+%#define _rpcsvc_rex_h
+#endif
+
 const STRINGSIZE = 1024;
 typedef string rexstring<1024>;
 
@@ -148,7 +153,7 @@
 	/* chars[2] == start output char */
 	/* chars[3] == stop output char */
 	/* chars[4] == end-of-file char */
-	/* chars[5] == input delimeter (like nl) */
+	/* chars[5] == input delimiter (like nl) */
 };
 
 struct ltchars {
@@ -227,3 +232,7 @@
 		REXPROC_SIGNAL(int) = 5;
 	} = 1;
 } = 100017;
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_rex_h*/
+#endif
diff -bBwur a/rpcsvc/rquota.x sunrpc-4.0.3-1/rpcsvc/rquota.x
--- a/rpcsvc/rquota.x	1989-07-11 21:49:01.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/rquota.x	2007-09-05 21:30:09.000000000 +0200
@@ -6,6 +6,11 @@
  * Requires unix authentication
  */
 
+#ifdef RPC_HDR
+%#ifndef _rpcsvc_rquota_h
+%#define _rpcsvc_rquota_h
+#endif
+
 const RQ_PATHLEN = 1024;
 
 struct getquota_args {
@@ -59,3 +64,7 @@
 		RQUOTAPROC_GETACTIVEQUOTA(getquota_args) = 2;
 	} = 1;
 } = 100011;
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_rquota_h*/
+#endif
diff -bBwur a/rpcsvc/rstat.c sunrpc-4.0.3-1/rpcsvc/rstat.c
--- a/rpcsvc/rstat.c	1989-07-11 21:49:02.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/rstat.c	2007-09-05 21:30:09.000000000 +0200
@@ -6,7 +6,8 @@
 
 #include <stdio.h>
 #include <sys/param.h>
-#include <rpc/rpc.h>        /* include <sys/time.h> */
+#include <rpc/rpc.h>
+#include <time.h>
 #include "rstat.h"
 
 main(argc, argv)
@@ -46,12 +47,12 @@
         exit(1);
     }
 
-    tmp_time = localtime(&host_stat->curtime.tv_sec);
+    tmp_time = localtime((time_t *)(&host_stat->curtime.tv_sec));
     host_time = *tmp_time;
 
     host_stat->curtime.tv_sec -= host_stat->boottime.tv_sec;
 
-    tmp_time = gmtime(&host_stat->curtime.tv_sec);
+    tmp_time = gmtime((time_t *)(&host_stat->curtime.tv_sec));
     host_uptime = *tmp_time;
 
     if (host_uptime.tm_yday != 0)
diff -bBwur a/rpcsvc/rstat.x sunrpc-4.0.3-1/rpcsvc/rstat.x
--- a/rpcsvc/rstat.x	1989-07-11 21:49:03.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/rstat.x	2007-09-05 21:30:09.000000000 +0200
@@ -35,6 +35,11 @@
  */
 
 #ifdef RPC_HDR
+%#ifndef _rpcsvc_rstat_h
+%#define _rpcsvc_rstat_h
+#endif
+
+#ifdef RPC_HDR
 
 %#ifndef FSCALE
 %/*
@@ -143,3 +148,7 @@
 		RSTATPROC_HAVEDISK(void) = 2;
 	} = 1;
 } = 100001;
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_rstat_h*/
+#endif
Only in sunrpc-4.0.3-1/rpcsvc: rusers.x
diff -bBwur a/rpcsvc/sm_inter.x sunrpc-4.0.3-1/rpcsvc/sm_inter.x
--- a/rpcsvc/sm_inter.x	1989-07-11 21:49:07.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/sm_inter.x	2007-09-05 21:30:09.000000000 +0200
@@ -36,6 +36,10 @@
  *
  */
 
+#ifdef RPC_HDR
+%#ifndef _rpcsvc_sm_inter_h
+%#define _rpcsvc_sm_inter_h
+#endif
 
 program SM_PROG { 
 	version SM_VERS  {
@@ -67,7 +71,7 @@
 };
 
 struct my_id {
-	string	 my_name<SM_MAXSTRLEN>;		/* name of the site iniates the monitoring request*/
+	string	 my_name<SM_MAXSTRLEN>;		/* name of the site initiating the monitoring request*/
 	int	my_prog;			/* rpc program # of the requesting process */
 	int	my_vers;			/* rpc version # of the requesting process */
 	int	my_proc;			/* rpc procedure # of the requesting process */
@@ -86,7 +90,7 @@
 
 
 /*
- * state # of status monitor monitonically increases each time
+ * state # of status monitor monotonically increases each time
  * status of the site changes:
  * an even number (>= 0) indicates the site is down and
  * an odd number (> 0) indicates the site is up;
@@ -114,3 +118,7 @@
 	int state;
 	opaque priv[16];		/* stored private information */
 };
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_sm_inter_h*/
+#endif
diff -bBwur a/rpcsvc/spray.x sunrpc-4.0.3-1/rpcsvc/spray.x
--- a/rpcsvc/spray.x	1989-07-11 21:49:08.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/spray.x	2007-09-05 21:30:09.000000000 +0200
@@ -35,6 +35,11 @@
  * Useful for testing flakiness of network interfaces
  */
 
+#ifdef RPC_HDR
+%#ifndef _rpcsvc_spray_h
+%#define _rpcsvc_spray_h
+#endif
+
 const SPRAYMAX = 8845;	/* max amount can spray */
 
 /*
@@ -82,3 +87,7 @@
 		SPRAYPROC_CLEAR(void) = 3;
 	} = 1;
 } = 100012;
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_spray_h*/
+#endif
diff -bBwur a/rpcsvc/yp.x sunrpc-4.0.3-1/rpcsvc/yp.x
--- a/rpcsvc/yp.x	1989-07-11 21:49:09.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/yp.x	2007-09-05 21:30:09.000000000 +0200
@@ -1,5 +1,3 @@
-/* @(#)yp.x	2.1 88/08/01 4.0 RPCSRC */
-
 /*
  * Sun RPC is a product of Sun Microsystems, Inc. and is provided for
  * unrestricted use provided that this legend is included on all tape
@@ -33,6 +31,16 @@
  * Protocol description file for the Yellow Pages Service
  */
 
+#ifdef RPC_HDR
+%#ifndef _rpcsvc_yp_h
+%#define _rpcsvc_yp_h
+#else
+%#ifndef lint
+%/*static char sccsid[] = "from: @(#)yp.x	2.1 88/08/01 4.0 RPCSRC";*/
+%static char rcsid[] = "$Id: yp.x,v 1.1.1.2 2007/09/01 06:22:28 dasilva Exp $";
+%#endif /* not lint */
+#endif
+
 const YPMAXRECORD = 1024;
 const YPMAXDOMAIN = 64;
 const YPMAXMAP = 64;
@@ -114,8 +122,13 @@
 
 struct ypresp_key_val {
 	ypstat stat;
+#ifdef STUPID_SUN_BUG /* These are backwards */
 	keydat key;
 	valdat val;
+#else
+	valdat val;
+	keydat key;
+#endif
 };
 
 
@@ -215,9 +228,78 @@
 
 
 /*
+ * NIS v1 support for backwards compatibility
+ */
+enum ypreqtype {
+	YPREQ_KEY = 1,
+	YPREQ_NOKEY = 2,
+	YPREQ_MAP_PARMS = 3
+};
+
+enum ypresptype {
+	YPRESP_VAL = 1,
+	YPRESP_KEY_VAL = 2,
+	YPRESP_MAP_PARMS = 3
+};
+
+union yprequest switch (ypreqtype yp_reqtype) {
+case YPREQ_KEY:
+	ypreq_key yp_req_keytype;
+case YPREQ_NOKEY:
+	ypreq_nokey yp_req_nokeytype;
+case YPREQ_MAP_PARMS:
+	ypmap_parms yp_req_map_parmstype;
+};
+
+union ypresponse switch (ypresptype yp_resptype) {
+case YPRESP_VAL:
+	ypresp_val yp_resp_valtype;
+case YPRESP_KEY_VAL:
+	ypresp_key_val yp_resp_key_valtype;
+case YPRESP_MAP_PARMS:
+	ypmap_parms yp_resp_map_parmstype;
+};
+
+#if !defined(YPBIND_ONLY) && !defined(YPPUSH_ONLY)
+/*
  * YP access protocol
  */
 program YPPROG {
+/*
+ * NIS v1 support for backwards compatibility
+ */
+	version YPOLDVERS {
+		void
+		YPOLDPROC_NULL(void) = 0;
+
+		bool
+		YPOLDPROC_DOMAIN(domainname) = 1;
+
+		bool
+		YPOLDPROC_DOMAIN_NONACK(domainname) = 2;
+
+		ypresponse
+		YPOLDPROC_MATCH(yprequest) = 3;
+
+		ypresponse
+		YPOLDPROC_FIRST(yprequest) = 4;
+
+		ypresponse
+		YPOLDPROC_NEXT(yprequest) = 5;
+
+		ypresponse
+		YPOLDPROC_POLL(yprequest) = 6;
+
+		ypresponse
+		YPOLDPROC_PUSH(yprequest) = 7;
+
+		ypresponse
+		YPOLDPROC_PULL(yprequest) = 8;
+
+		ypresponse
+		YPOLDPROC_GET(yprequest) = 9;
+	} = 1;
+
 	version YPVERS {
 		void 
 		YPPROC_NULL(void) = 0;
@@ -232,8 +314,11 @@
 		YPPROC_MATCH(ypreq_key) = 3;
 
 		ypresp_key_val 
+#ifdef STUPID_SUN_BUG /* should be ypreq_nokey */
 		YPPROC_FIRST(ypreq_key) = 4;
-
+#else
+		YPPROC_FIRST(ypreq_nokey) = 4;
+#endif
 		ypresp_key_val 
 		YPPROC_NEXT(ypreq_key) = 5;
 
@@ -256,8 +341,8 @@
 		YPPROC_MAPLIST(domainname) = 11;
 	} = 2;
 } = 100004;
-
-
+#endif
+#if !defined(YPSERV_ONLY) && !defined(YPBIND_ONLY)
 /*
  * YPPUSHPROC_XFRRESP is the callback routine for result of YPPROC_XFR
  */
@@ -265,13 +350,17 @@
 	version YPPUSH_XFRRESPVERS {
 		void
 		YPPUSHPROC_NULL(void) = 0;
-
+#ifdef STUPID_SUN_BUG /* argument and return value are backwards */
 		yppushresp_xfr	
 		YPPUSHPROC_XFRRESP(void) = 1;
+#else
+		void
+		YPPUSHPROC_XFRRESP(yppushresp_xfr) = 1;
+#endif
 	} = 1;
 } = 0x40000000;	/* transient: could be anything up to 0x5fffffff */
-
-
+#endif
+#if !defined(YPSERV_ONLY) && !defined(YPPUSH_ONLY)
 /*
  * YP binding protocol
  */
@@ -288,4 +377,8 @@
 	} = 2;
 } = 100007;
 
+#endif
 
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_yp_h*/
+#endif
diff -bBwur a/rpcsvc/yppasswd.x sunrpc-4.0.3-1/rpcsvc/yppasswd.x
--- a/rpcsvc/yppasswd.x	1989-07-11 21:49:11.000000000 +0200
+++ sunrpc-4.0.3-1/rpcsvc/yppasswd.x	2007-09-05 21:30:10.000000000 +0200
@@ -34,6 +34,12 @@
  * YP password update protocol
  * Requires unix authentication
  */
+
+#ifdef RPC_HDR
+%#ifndef _rpcsvc_yppasswd_h
+%#define _rpcsvc_yppasswd_h
+#endif
+
 program YPPASSWDPROG {
 	version YPPASSWDVERS {
 		/*
@@ -61,3 +67,7 @@
 };
 
 
+
+#ifdef RPC_HDR
+%#endif /*!_rpcsvc_yppasswd_h*/
+#endif
Only in sunrpc-4.0.3-1/secure_rpc: CVS
Only in sunrpc-4.0.3-1/secure_rpc/bin: CVS
Only in sunrpc-4.0.3-1/secure_rpc/demo: CVS
Only in sunrpc-4.0.3-1/secure_rpc/des: CVS
Only in sunrpc-4.0.3-1/secure_rpc/doc: CVS
Only in sunrpc-4.0.3-1/secure_rpc/keyserv: CVS
Only in sunrpc-4.0.3-1/secure_rpc/man: CVS
Only in sunrpc-4.0.3-1/secure_rpc/rpc: CVS
